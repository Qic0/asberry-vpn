<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Asburium VPN</title>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <!-- CSS -->
  <link rel="stylesheet" href="/static/main.css" />
</head>

<body>

<div id="overlay" class="drawer-overlay"></div>

<div id="drawer" class="drawer">
  <div class="user">
    <img id="avatar">
    <div>
      <strong id="username">User</strong><br>
      <small>ID: <span id="userid"></span></small>
    </div>
  </div>

  <div class="balance-card">
    <div>–ú–æ–π –±–∞–ª–∞–Ω—Å</div>
    <strong id="drawerBalance">üí∞ 0 ‚ÇΩ</strong>
    <button id="drawerTopupBtn">–ü–æ–ø–æ–ª–Ω–∏—Ç—å</button>
  </div>

  <div class="item">üë§ –ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</div>
  <div class="item">üéÅ –ü—Ä–∏–≥–ª–∞—Å–∏ –¥—Ä—É–≥–∞ (+50 ‚ÇΩ)</div>
  <div class="item">üìò –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏</div>
  <div class="item">üè∑ –ü—Ä–æ–º–æ–∫–æ–¥</div>
  <div class="item" style="color:#22c55e">üõü –ü–æ–¥–¥–µ—Ä–∂–∫–∞</div>
</div>

<header class="header">
  <div class="header-bar">
    <div id="menuBtn" class="menu-btn">‚ò∞</div>
    <div class="balance">
      üí∞ <span id="headerBalance">0 ‚ÇΩ</span>
      <div id="plusBtn" class="plus">+</div>
    </div>
  </div>
</header>

<main class="main">

  <!-- VPN -->
  <div id="vpn" class="view active">
    <div class="card">
      <h3>VPN</h3>
      <p style="opacity:.7;margin:8px 0">
        –°–æ–∑–¥–∞–π—Ç–µ VPN-–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –¥–ª—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
      </p>
      <button class="primary-btn" id="createVpnBtn">
        ‚ûï –°–æ–∑–¥–∞—Ç—å VPN
      </button>
    </div>
  </div>

  <!-- TOPUP -->
  <div id="topup" class="view">
    <div class="card">
      <div class="topup-title">–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞</div>
      <div class="topup-sub">–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã –∏ —Å—É–º–º—É</div>

      <div class="pay-methods">
        <div class="pay-method active">üí∞<span>–°–ë–ü</span></div>
        <div class="pay-method">üí≥<span>–ë–∞–Ω–∫–æ–≤—Å–∫–∞—è –∫–∞—Ä—Ç–∞</span></div>
      </div>

      <div class="amount active">
        <strong>150 ‚ÇΩ</strong>
        <small>–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ 1 –º–µ—Å—è—Ü</small>
      </div>
      <div class="amount">
        <strong>300 ‚ÇΩ</strong>
        <small>–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ 2 –º–µ—Å—è—Ü–∞</small>
      </div>
      <div class="amount">
        <strong>450 ‚ÇΩ</strong>
        <small>–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ 3 –º–µ—Å—è—Ü–∞</small>
      </div>

      <button class="primary-btn" id="payBtn">
        –ü–µ—Ä–µ–π—Ç–∏ –∫ –æ–ø–ª–∞—Ç–µ
      </button>
    </div>
  </div>

  <!-- HELP -->
  <div id="help" class="view">
    <div class="card">–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏</div>
  </div>

</main>

<footer class="footer">
  <div class="footer-btn" data-tab="topup">–ü–æ–ø–æ–ª–Ω–∏—Ç—å</div>
  <div class="footer-core" data-tab="vpn">VPN</div>
  <div class="footer-btn" data-tab="help">–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏</div>
</footer>

<script>
/* ================= TELEGRAM ================= */
const tg = window.Telegram.WebApp;
tg.ready();
tg.expand();

/* ================= USER ================= */
const user = tg.initDataUnsafe?.user;
if (user) {
  avatar.src = user.photo_url || "";
  username.textContent = user.first_name || "User";
  userid.textContent = user.id || "";
}

/* ================= API ================= */
async function createVPN() {
  try {
    const res = await fetch("/api/vpn/create", {
      method: "POST",
      headers: {
        "X-Telegram-Init-Data": tg.initData
      }
    });

    if (!res.ok) throw new Error(await res.text());
    const data = await res.json();

    tg.showAlert("VPN —Å–æ–∑–¥–∞–Ω");
    console.log("VLESS:", data.vless_url);

  } catch (e) {
    console.error(e);
    tg.showAlert("–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è VPN");
  }
}

/* ================= NAV ================= */
function openTab(tab) {
  document.querySelectorAll(".view").forEach(v => v.classList.remove("active"));
  document.getElementById(tab).classList.add("active");

  document.querySelectorAll(".footer-btn").forEach(b => b.classList.remove("active"));
  document.querySelector(`[data-tab="${tab}"]`)?.classList.add("active");
}

/* ================= EVENTS ================= */
menuBtn.onclick = () => {
  drawer.classList.add("open");
  overlay.classList.add("open");
};

overlay.onclick = () => {
  drawer.classList.remove("open");
  overlay.classList.remove("open");
};

plusBtn.onclick = () => openTab("topup");

drawerTopupBtn.onclick = () => {
  drawer.classList.remove("open");
  overlay.classList.remove("open");
  openTab("topup");
};

document.querySelectorAll("[data-tab]").forEach(btn => {
  btn.onclick = () => openTab(btn.dataset.tab);
});

document.getElementById("createVpnBtn").onclick = createVPN;

payBtn.onclick = () => tg.showAlert("–ü–µ—Ä–µ—Ö–æ–¥ –∫ –æ–ø–ª–∞—Ç–µ");
</script>

</body>
</html>

